---
title: 'Visualizing Control-FREEC BAF and LogR data with IGV'
date: 2020-05-07
permalink: /posts/2020/05/control-freec-igv/
tags:
  - CNV
  - Control-FREEC
  - structural variants
---
## Visualizing Control-FREEC BAF and LogR data with IGV

[Control-FREEC](http://boevalab.inf.ethz.ch/FREEC/) is a software "for detection of copy-number changes and allelic imbalances (including LOH) using deep-sequencing data" according to their homepage. Although this page is about visualizing Control-FREEC data, a similar software called [ASCAT](https://www.crick.ac.uk/research/labs/peter-van-loo/software) is also used in Sarek for CNV/LOH/ploidy and cell purity estimation. Explanation of BAF and LogR can be found at doi:10.1007/978-1-61779-400-1_4 .

[Integrative Genomics Viewer a.k.a. IGV](https://igv.org/) is not the best, not the fastest, but likely the most popular browser for NGS data. Good news is that besides BAM, BED and VCF files it can also show BedGraph format files. 

Control-FREEC results are saved by Sarek in the `results/VariantCalling/TUMOR_vs_NORMAL/Control-FREEC` directory, and there are two .BedGraph entries: `*.pileup_ratio.BedGraph` contains LogR values for the tumor sample `*.pileup_normal_ratio.BedGraph` is the same, well, for the normal sample. 

The [BedGraph](https://genome.ucsc.edu/goldenPath/help/bedgraph.html) format itself is an extension of BED: have to begin with a track description line and values are listed as `chromosome start end value` delimited by tabs. This way we can visualize LogR values:

```
track type=bedGraph name="copy neutral LOH from T.pileup.gz_ratio.BedGraph" description="Copy Neutral LOH" color=100,100,100
chr1    124950000       125000000       3.5375
chr1    125000000       125050000       3.43962
chr1    150750000       150800000       3.0908
chr1    150800000       150850000       3.10692
chr1    150850000       150900000       2.69283
chr1    150900000       150950000       3.04243
chr1    150950000       151000000       3.19796
```

It is straightforward to load these two files to IGV, but first we will be disappointed, as we will see (if at all) only two thin bright green lines (here shown for chr3 of HeLa cells):

<br/><img src='/images/HeLa_chr3_logr_default.png'>

So, _right_-click on the track, and 
 - Change track height to 200 
 - Change track color to blue or red (only for positive values)
 - use Points instead of bars
 - use Autoscale
 
and do it for both tracks. In the picture below I use blue for the normal, and red for the tumour tracks:

<br/><img src='/images/HeLa_blue_red_logr.png'>

Now we can zoom in and have a better look at the ratio changes.


Processing BAF data to be read by IGV
------

There are two BAF files generated by Control-FREEC, one for the tumour, one for the normal, each having `*BAF.txt` extensions. The fileformat is simple also:

```
Chromosome      Position        BAF     FittedA FittedB A       B       uncertainty
1       10250   0.0702948       -1      -1      -1      -1      -1
1       10904   0.375   -1      -1      -1      -1      -1
1       11565   0.138889        -1      -1      -1      -1      -1
```

To make a BedGraph we need the first three columns only. There is one issue though, the chromosomes are not ordered:

```
$ awk '{print $1}' NA12878N.pileup_BAF.txt| uniq
Chromosome
1
10
11
[...]
2
20
[...]
```

Therefore, the BAF file needs not only column re-arrangement, but sorting as well beforehand. The small awk script (at [btb-scripts/cf2BedGraph.awk](https://github.com/szilvajuhos/btb-scripts/blob/master/cf2BedGraph.awk) also writes the BedGraph header line generated from the input filename. Use it like:

```
$ tail -n +2 SAMPLE.pileup_BAF.txt| sort -V -k1,1 -k2,2n > SAMPLE.BAF
$ awk -f cf2BedGraph.awk SAMPLE.BAF > SAMPLE.BAF.BedGraph
```

The `tail` part is needed to get rid of the very first unneded line of the file. Once the BedGraph for the BAF is ready for the tumour and the normal sample, we can load and visualize it just for LogR. Do not forget to change track size, colours, points and autoscale. In IGV we can have all the four in a single window:

<br/><img src='/images/LogR_and_BAF.png'>





